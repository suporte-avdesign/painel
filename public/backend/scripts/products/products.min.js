!function(t,e){t.fn.loadTableProducts=function(){var e=Handlebars.compile(t("#painel-"+tableProduct.id).html()),a=t("#"+tableProduct.id).DataTable({processing:!0,serverSide:!0,ajax:{url:tableProduct.url,type:"POST",dataType:"json",headers:{"X-CSRF-TOKEN":tableProduct.token}},sScrollX:!0,sScrollXInner:"100%",buttons:["reset"],sPaginationType:"full_numbers",iDisplayLength:tableProduct.limit,sDom:'CB<"clear"><"dataTables_header"lfr>t<"dataTables_footer"ip>',fnDrawCallback:function(e){tableProduct.tableStyled||(t("#"+tableProduct.id).closest(".dataTables_wrapper").find(".dataTables_length select").addClass("select "+tableProduct.color+" glossy").styleSelect(),t("#btn-reset").addClass(tableProduct.color+" glossy"),tableProduct.tableStyled=!0)},columns:[{data:null,searchable:!1,render:function(t,e,a){return t.image}},{data:"visits.0",className:"align-center"},{data:"new",className:"align-center"},{data:"offer.0",className:"align-center"},{data:"active",className:"align-center"},{data:"featured",className:"align-center"},{data:"trend",className:"align-center"},{data:"black_friday",className:"align-center"},{data:null,className:"details-control",orderable:!1,searchable:!1,defaultContent:""}],order:[[0,"desc"]]});t("#"+tableProduct.id).on("click",tableProduct.openDetails,function(){if(event.target===this){var o=t(this).closest("tr"),r=a.row(o);r.child.isShown()?(r.child.hide(),o.removeClass("shown"),o.children().removeClass(tableProduct.colorSel)):(r.child(e(r.data())).show(),o.addClass("shown"),o.children().addClass(tableProduct.colorSel))}}),formProduct=function(e,o){var r=t("#form-"+e),i=r.attr("action");return t.ajax({beforeSend:function(){setBtn(2,tableProduct.txtLoader,!1,"loader","submit-product","btn-product")},type:"POST",dataType:"json",url:i,data:r.serialize(),success:function(e){if(1==e.success){if(setBtn(2,tableProduct.txtNext,!0,"icon-forward","submit-product","btn-product"),"create"==o){t('input[name="prod[name]"]').val("");var r=t("#count_product").html(),i=parseFloat(r)+1;t("#count_product").html(i);var c=t("#count-section-"+e.product.section_id).html(),n=parseFloat(c)+1;t("#count-section-"+e.product.section_id).html(n);var s=t("#count-category-"+e.product.category_id).html(),l=parseFloat(s)+1;t("#count-category-"+e.product.category_id).html(l),t('input[name="img[order]"]').val("1"),t("#insert_product").html('<input name="img[product_id]" type="hidden" value="'+e.product.id+'"><input name="img[product_name]" type="hidden" value="'+e.product.name+'"><input name="img[brand]" type="hidden" value="'+e.product.brand+'"><input name="img[section]" type="hidden" value="'+e.product.section+'"><input name="img[category]" type="hidden" value="'+e.product.category+'"><input name="img[kit_name]" type="hidden" value="'+e.product.kit_name+'">'),nextTabs("new-product","show-colors",!0)}else{if(1==e.refresh)t("#info-product-"+e.id).load(e.redirect,function(){fechaModal()});else{if(1==e.change){var d=t("#count-section-"+e.current.section_id).html(),u=parseFloat(d)-1;t("#count-section-"+e.current.section_id).html(u);var p=t("#count-category-"+e.current.category_id).html(),m=parseFloat(p)-1;t("#count-category-"+e.current.category_id).html(m);var f=t("#count-section-"+e.update.section_id).html(),h=parseFloat(f)+1;t("#count-section-"+e.update.section_id).html(h);var g=t("#count-category-"+e.update.category_id).html(),v=parseFloat(g)+1;t("#count-category-"+e.update.category_id).html(v)}a.ajax.reload(),fechaModal()}a.ajax.reload(),fechaModal()}msgNotifica(!0,e.message,!0,!1)}else setBtn(2,tableProduct.txtNext,!0,"icon-forward","submit-product","btn-product"),msgNotifica(!1,e.message,!0,!1)},error:function(t){setBtn(2,tableProduct.txtNext,!0,"icon-forward","submit-product","btn-product"),ajaxFormError(t)}}),!1},get_prices=function(e,a){var o=t("#price_card_percent_1").val()/100,r=t("input[name='price[1][price_card]']").val(),i=new Number(r-o*r).toFixed(2);t("input[name='price[1][price_cash]']").val(i),1==a&&t.ajax({beforeSend:function(){t("#load_prices").html('<span class="loader"></span>')},type:"POST",dataType:"html",url:e,data:{card:r,cash:i,_token:tableProduct.token},success:function(e){t("#load_prices").html(e)},error:function(e){t("#load_prices").html(""),ajaxFormError(e)}})},get_offers=function(e,a,o){if(1==a){var r=t("#price_card_percent_1").val();t("#offer_percent_1").val(r),t("#normal_offer").show()}else t("#normal_offer").hide();1==o&&t.ajax({beforeSend:function(){t("#get_offers").html('<span class="loader"></span>')},type:"POST",dataType:"html",url:e,data:{opc:a,_token:tableProduct.token},success:function(e){t("#get_offers").html(e)},error:function(e){t("#get_offers").html(""),ajaxFormError(e)}})},statusFields=function(e,a,o,r,i){var c,n=t("#"+e+"-"+a);t(this);c=1==r?0:1,t.ajax({type:"POST",headers:{"X-CSRF-TOKEN":i},dataType:"json",url:o,data:{_method:"put",field:e,status:c},beforeSend:function(){n.html('<span class="loader"></span>')},success:function(t){1==t.success?(n.html(t.click),msgNotifica(!0,t.message,!0,!1)):msgNotifica(!1,t.message,!0,!1)},error:function(t){ajaxFormError(t)}})},deleteProduct=function(e,o){t.modal.confirm(tableProduct.txtConfirm+" "+o+"?",function(){t.ajax({type:"DELETE",dataType:"json",headers:{"X-CSRF-TOKEN":tableProduct.token},url:e,success:function(e){if(1==e.success){var o=t("#count_colors").html(),r=parseFloat(o)-e.product.total_colors;t("#count_colors").html(r);var i=t("#count_product").html(),c=parseFloat(i)-1;t("#count_product").html(c);var n=t("#count-section-"+e.product.section_id).html(),s=parseFloat(n)-1;t("#count-section-"+e.product.section_id).html(s);var l=t("#count-category-"+e.product.category_id).html(),d=parseFloat(l)-1;t("#count-category-"+e.product.category_id).html(d),a.ajax.reload(),msgNotifica(!0,e.message,!0,!1)}else msgNotifica(!1,e.message,!0,!1)},error:function(t){ajaxFormError(t)}})},function(){t.modal.alert(tableProduct.txtCancel)})},calculateCash=function(e,a){if("offer"==a){var o=t("input[name='price["+e+"][offer_percent]']").val()/100,r=t("input[name='price["+e+"][offer_card]']").val(),i=o*r,c=new Number(r-i).toFixed(2);t("input[name='price["+e+"][offer_cash]']").val(c)}if("price"==a){o=t("#price_card_percent_"+e).val()/100;var n=t("input[name='price["+e+"][price_card]']").val();i=o*n,c=new Number(n-i).toFixed(2);t("input[name='price["+e+"][price_cash]']").val(c);var s=t("#ids_prices").val().split(",");t.each(s,function(a,o){var r=t("#price_card_"+e).val(),i=t("input[name='price["+o+"][price_card_percent]']").val(),c=t("input[name='price["+o+"][price_cash_percent]']").val(),n=i.replace("+","").replace("-","")/100*r;if(i>=0)var s=+r+n;else s=r-n;var l=new Number(s).toFixed(2),d=c.replace("+","").replace("-","")/100*r;if(c>=0)var u=+r+d;else u=r-d;var p=new Number(u).toFixed(2);t("#price_card_"+o).val(l),t("#price_cash_"+o).val(p)})}},setFreight=function(e){1==e?(t("#fields_freight").show(),t("#freight").val(1)):(t("#freight").val(0),t("#fields_freight").hide())},setOffer=function(e){1==e&&t("#values_offers").show(),0==e&&t("#values_offers").hide()},preview_image=function(e,a,o){t("#"+a).html("");for(var r=document.getElementById(e).files.length,i=0;i<r;i++)t("#"+a).append('<img src="'+URL.createObjectURL(event.target.files[i])+'" width="'+o+'">')},setKit=function(e,a,o){1==a?t("#kits").show():t("#kits").hide(),t("#grid_kit").val(a),t(".grid_colors").children(".select-value").text("Selecione Uma"),t("#box-grids-colors").html("")},setStock=function(e,a,o){t("#grid_stock").val(a),t(".grid_colors").children(".select-value").text("Selecione Uma"),t("#box-grids-colors").html("")},addGrid=function(e){kit=t("input[name='img[kit]']:checked").val(),stock=t("input[name='img[stock]']:checked").val(),console.log("KIT: "+kit),console.log("STOCK: "+stock);var a,o=Math.random();1==stock?1==kit?(a='<li class="new_grid">',a+='<span class="input">',a+='<input type="text" name="grids['+o+'][grid]" id="grid_'+e+'" placeholder="'+tableProduct.txtGrid+'" class="input-unstyled input-sep" value="" maxlength="4" style="width: 50px;">',a+='<input type="text" name="grids['+o+'][entry]" id="entry_'+e+'" placeholder="'+tableProduct.txtEntry+'" class="input-unstyled input-sep" value="" maxlength="4" style="width: 50px;">',a+="</span>",a+='<div class="button-group absolute-right compact">',a+='<button onclick="removeThis(this,\'.new_grid\');" class="button icon-trash red-gradient with-tooltip" title="Excluir"></button>',a+="</div>",a+="</li>"):(a='<li class="new_grid">',a+='<span class="input">',a+='<input type="text" name="grids['+o+'][grid]" id="grid_'+e+'" placeholder="'+tableProduct.txtGrid+'" class="input-unstyled input-sep" value="" maxlength="4" style="width: 50px;">',a+='<input type="text" name="grids['+o+'][entry]" id="entry_'+e+'" placeholder="'+tableProduct.txtEntry+'" class="input-unstyled input-sep" value="" maxlength="4" style="width: 50px;">',a+='<input type="text" name="grids['+o+'][low]" id="exit_'+e+'" placeholder="'+tableProduct.txtLow+'" class="input-unstyled input-sep" value="" style="width: 50px;">',a+="</span>",a+='<div class="button-group absolute-right compact">',a+='<button onclick="removeThis(this,\'.new_grid\');" class="button icon-trash red-gradient with-tooltip" title="Excluir"></button>',a+="</div>",a+="</li>"):(a='<li class="new_grid">',a+='<span class="input">',a+='<input type="text" name="grids['+o+'][grid]" id="grid_'+e+'" placeholder="'+tableProduct.txtGrid+'" class="input-unstyled input-sep" value="" style="width: 50px;">',a+="</span>",a+='<div class="button-group absolute-right compact">',a+='<button onclick="removeThis(this,\'.new_grid\');" class="button icon-trash red-gradient with-tooltip" title="Excluir"></button>',a+="</div>",a+="</li>"),t("#grids-"+e).append(a)},removeThis=function(e,a){t(e).parents(a).remove()},statusColor=function(e,a,o,r,i){var c;c=1==o?0:1,t.ajax({type:"POST",headers:{"X-CSRF-TOKEN":i},dataType:"json",url:a,data:{_method:"put",active:c},success:function(a){1==a.success?(1==r&&0==c&&t.modal.alert('<span class="red">'+a.alert+"</span>"),t("#btns-"+e).html(a.html),msgNotifica(!0,a.message,!0,!1)):msgNotifica(!1,a.message,!0,!1)},error:function(t){ajaxFormError(t)}})},deleteColor=function(e,o){t.modal.confirm(tableProduct.txtConfirm+" "+name+"?",function(){t.ajax({type:"DELETE",dataType:"json",url:o,headers:{"X-CSRF-TOKEN":tableProduct.token},success:function(o){1==o.success?(1==o.reload?a.ajax.reload():t("#img-colors-"+e).remove(),msgNotifica(!0,o.message,!0,!1)):msgNotifica(!1,o.message,!0,!1)},error:function(t){ajaxFormError(t)}})},function(){t.modal.alert(tableProduct.txtCancel)})},statusPosition=function(e,a,o,r){var i;i=1==o?0:1,t.ajax({type:"POST",headers:{"X-CSRF-TOKEN":r},dataType:"json",url:a,data:{_method:"put",active:i},success:function(a){1==a.success?(t("#btns-"+e).html(a.html),msgNotifica(!0,a.message,!0,!1)):msgNotifica(!1,a.message,!0,!1)},error:function(t){ajaxFormError(t)}})},deletePosition=function(e,a){t.ajax({type:"DELETE",dataType:"json",url:a,headers:{"X-CSRF-TOKEN":tableProduct.token},success:function(a){1==a.success?(t("#img-positions-"+e).hide(),msgNotifica(!0,a.message,!0,!1)):msgNotifica(!1,a.message,!0,!1)},error:function(t){ajaxFormError(t)}})},t("body").on("click","#btn-colors",function(e){t(this).parents("#form-colors").ajaxForm(o)});var o={beforeSend:function(){setBtn(1,tableProduct.txtLoader,!1,"loader disbeled","submit-colors","btn-colors")},success:function(e){if(1==e.success){if("create"==e.ac){t('input[name="img[code]"]').val(""),t('input[name="img[color]"]').val(""),t('input[name="img[html]"]').val(""),t("#barvadiv").attr("style","margin-top:2px;width:100px;height:100px;"),t("#uploadCanvas").val("");var o=t("#cover_id").val();t("#load_cover_"+o).html('<label for="img_cover_'+o+'_1" class="button green-active"><input type="radio" name="img[cover]" id="img_cover_'+o+'_1" value="1">Sim</label><label for="img_cover_'+o+'_2" class="button red-active active"><input type="radio" name="img[cover]" id="img_cover_'+o+'_2" value="0" checked>Não</label>'),t(".color").removeAttr("data-selected"),t("#group-colors-"+o).html('<span class="groups"></span>');var r=t('input[name="img[order]"]').val(),i=parseFloat(r)+1;t('input[name="img[order]"]').val(i),t('input[name="pos[order]"]').val("1");var c=t("#count_colors").html(),n=parseFloat(c)+1;t("#count_colors").html(n),nextTabs("new-product","show-positions",!0),t("#insert_color").html('<input name="pos[image_color_id]" type="hidden" value="'+e.id+'"><input name="pos[name]" type="hidden" value="'+e.name+'"><input name="pos[color]" type="hidden" value="'+e.color+'"><input name="pos[code]" type="hidden" value="'+e.code+'">'),setBtn(1,tableProduct.txtNext,!0,"icon-forward","submit-colors","btn-colors"),a.ajax.reload()}if("add"==e.ac){c=t("#count_colors").html(),n=parseFloat(c)+1;t("#count_colors").html(n),t("#gallery-colors-"+e.product_id).prepend(e.html),fechaModal()}"update"==e.ac&&(t("#img-colors-"+e.id).html(e.html),fechaModal()),msgNotifica(!0,e.message,!0,!1)}else msgNotifica(!1,e.message,!0,!1),setBtn(1,tableProduct.txtSave,!0,"icon-tick","submit-colors","btn-colors")},error:function(t){ajaxFormError(t),setBtn(1,tableProduct.txtSave,!0,"icon-tick","submit-colors","btn-colors")}};t("body").on("click","#btn-position",function(e){t(this).parents("#form-positions").ajaxForm(r)});var r={beforeSend:function(){setBtn(1,tableProduct.txtLoader,!1,"loader","submit-position","btn-position")},success:function(e){if(1==e.success){if("add"==e.ac)t("#gallery-positions-"+e.color_id).prepend(e.html),fechaModal();else if("update"==e.ac)t("#img-positions-"+e.id).html(e.html),fechaModal();else{setBtn(1,tableProduct.txtNext,!0,"icon-forward","submit-position","btn-position");var a=t('input[name="pos[order]"]').val(),o=parseFloat(a)+1;t('input[name="pos[order]"]').val(o),t("#upload_position").val("")}msgNotifica(!0,e.message,!0,!1)}},complete:function(t){setBtn(1,tableProduct.txtNext,!0,"icon-forward","submit-position","btn-position")},error:function(t){ajaxFormError(t),setBtn(1,tableProduct.txtNext,!0,"icon-forward","submit-position","btn-position")}}}}(jQuery);
