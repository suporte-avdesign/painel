!function(e,t){e.fn.loadTableProducts=function(){var t=Handlebars.compile(e("#painel-"+tableProduct.id).html()),a=e("#"+tableProduct.id).DataTable({processing:!0,serverSide:!0,ajax:{url:tableProduct.url,type:"POST",dataType:"json",headers:{"X-CSRF-TOKEN":tableProduct.token}},sScrollX:!0,sScrollXInner:"100%",buttons:["reset"],sPaginationType:"full_numbers",iDisplayLength:tableProduct.limit,sDom:'CB<"clear"><"dataTables_header"lfr>t<"dataTables_footer"ip>',fnDrawCallback:function(t){tableProduct.tableStyled||(e("#"+tableProduct.id).closest(".dataTables_wrapper").find(".dataTables_length select").addClass("select "+tableProduct.color+" glossy").styleSelect(),e("#btn-reset").addClass(tableProduct.color+" glossy"),tableProduct.tableStyled=!0)},columns:[{data:null,searchable:!1,render:function(e,t,a){return e.image}},{data:"visits.0",className:"align-center"},{data:"new",className:"align-center"},{data:"offer.0",className:"align-center"},{data:"active",className:"align-center"},{data:"featured",className:"align-center"},{data:"trend",className:"align-center"},{data:"black_friday",className:"align-center"},{data:null,className:"details-control",orderable:!1,searchable:!1,defaultContent:""}],order:[[0,"desc"]]});e("#"+tableProduct.id).on("click",tableProduct.openDetails,function(){if(event.target===this){var r=e(this).closest("tr"),o=a.row(r);o.child.isShown()?(o.child.hide(),r.removeClass("shown"),r.children().removeClass(tableProduct.colorSel)):(o.child(t(o.data())).show(),r.addClass("shown"),r.children().addClass(tableProduct.colorSel))}}),tableAjaxReload=function(){a.ajax.reload()},formProduct=function(t,r){var o=e("#form-"+t),c=o.attr("action");return e.ajax({beforeSend:function(){setBtn(2,tableProduct.txtLoader,!1,"loader","submit-product","btn-product")},type:"POST",dataType:"json",url:c,data:o.serialize(),success:function(t){if(1==t.success){if(setBtn(2,tableProduct.txtNext,!0,"icon-forward","submit-product","btn-product"),"create"==r){e('input[name="prod[name]"]').val("");var o=e("#count_product").html(),c=parseFloat(o)+1;e("#count_product").html(c);var n=e("#count-section-"+t.product.section_id).html(),l=parseFloat(n)+1;e("#count-section-"+t.product.section_id).html(l);var i=e("#count-category-"+t.product.category_id).html(),s=parseFloat(i)+1;e("#count-category-"+t.product.category_id).html(s),e('input[name="img[order]"]').val("1"),e("#insert_product").html('<input name="img[product_id]" type="hidden" value="'+t.product.id+'"><input name="img[product_name]" type="hidden" value="'+t.product.name+'"><input name="img[brand]" type="hidden" value="'+t.product.brand+'"><input name="img[section]" type="hidden" value="'+t.product.section+'"><input name="img[category]" type="hidden" value="'+t.product.category+'"><input name="img[kit_name]" type="hidden" value="'+t.product.kit_name+'">'),nextTabs("new-product","show-colors",!0)}else{if(1==t.refresh)e("#info-product-"+t.id).load(t.redirect,function(){fechaModal()});else{if(1==t.change){var d=e("#count-section-"+t.current.section_id).html(),u=parseFloat(d)-1;e("#count-section-"+t.current.section_id).html(u);var p=e("#count-category-"+t.current.category_id).html(),m=parseFloat(p)-1;e("#count-category-"+t.current.category_id).html(m);var f=e("#count-section-"+t.update.section_id).html(),h=parseFloat(f)+1;e("#count-section-"+t.update.section_id).html(h);var _=e("#count-category-"+t.update.category_id).html(),g=parseFloat(_)+1;e("#count-category-"+t.update.category_id).html(g)}a.ajax.reload(),fechaModal()}a.ajax.reload(),fechaModal()}msgNotifica(!0,t.message,!0,!1)}else setBtn(2,tableProduct.txtNext,!0,"icon-forward","submit-product","btn-product"),msgNotifica(!1,t.message,!0,!1)},error:function(e){setBtn(2,tableProduct.txtNext,!0,"icon-forward","submit-product","btn-product"),ajaxFormError(e)}}),!1},get_prices=function(t,a){var r=e("#price_card_percent_1").val()/100,o=e("input[name='price[1][price_card]']").val(),c=new Number(o-r*o).toFixed(2);e("input[name='price[1][price_cash]']").val(c),1==a&&e.ajax({beforeSend:function(){e("#load_prices").html('<span class="loader"></span>')},type:"POST",dataType:"html",url:t,data:{card:o,cash:c,_token:tableProduct.token},success:function(t){e("#load_prices").html(t)},error:function(t){e("#load_prices").html(""),ajaxFormError(t)}})},get_offers=function(t,a,r){if(1==a){var o=e("#price_card_percent_1").val();e("#offer_percent_1").val(o),e("#normal_offer").show()}else e("#normal_offer").hide();1==r&&e.ajax({beforeSend:function(){e("#get_offers").html('<span class="loader"></span>')},type:"POST",dataType:"html",url:t,data:{opc:a,_token:tableProduct.token},success:function(t){e("#get_offers").html(t)},error:function(t){e("#get_offers").html(""),ajaxFormError(t)}})},statusFields=function(t,a,r,o,c){var n,l=e("#"+t+"-"+a);e(this);n=1==o?0:1,e.ajax({type:"POST",headers:{"X-CSRF-TOKEN":c},dataType:"json",url:r,data:{_method:"put",field:t,status:n},beforeSend:function(){l.html('<span class="loader"></span>')},success:function(e){1==e.success?(l.html(e.click),msgNotifica(!0,e.message,!0,!1)):msgNotifica(!1,e.message,!0,!1)},error:function(e){ajaxFormError(e)}})},deleteProduct=function(t,r){e.modal.confirm(tableProduct.txtConfirm+" "+r+"?",function(){e.ajax({type:"DELETE",dataType:"json",headers:{"X-CSRF-TOKEN":tableProduct.token},url:t,success:function(t){if(1==t.success){var r=e("#count_colors").html(),o=parseFloat(r)-t.product.total_colors;e("#count_colors").html(o);var c=e("#count_product").html(),n=parseFloat(c)-1;e("#count_product").html(n);var l=e("#count-section-"+t.product.section_id).html(),i=parseFloat(l)-1;e("#count-section-"+t.product.section_id).html(i);var s=e("#count-category-"+t.product.category_id).html(),d=parseFloat(s)-1;e("#count-category-"+t.product.category_id).html(d),a.ajax.reload(),msgNotifica(!0,t.message,!0,!1)}else msgNotifica(!1,t.message,!0,!1)},error:function(e){ajaxFormError(e)}})},function(){e.modal.alert(tableProduct.txtCancel)})},calculateCash=function(t,a){if("offer"==a){var r=e("input[name='price["+t+"][offer_percent]']").val()/100,o=e("input[name='price["+t+"][offer_card]']").val(),c=r*o,n=new Number(o-c).toFixed(2);e("input[name='price["+t+"][offer_cash]']").val(n)}if("price"==a){r=e("#price_card_percent_"+t).val()/100;var l=e("input[name='price["+t+"][price_card]']").val();c=r*l,n=new Number(l-c).toFixed(2);e("input[name='price["+t+"][price_cash]']").val(n);var i=e("#ids_prices").val().split(",");e.each(i,function(a,r){var o=e("#price_card_"+t).val(),c=e("input[name='price["+r+"][price_card_percent]']").val(),n=e("input[name='price["+r+"][price_cash_percent]']").val(),l=c.replace("+","").replace("-","")/100*o;if(c>=0)var i=+o+l;else i=o-l;var s=new Number(i).toFixed(2),d=n.replace("+","").replace("-","")/100*o;if(n>=0)var u=+o+d;else u=o-d;var p=new Number(u).toFixed(2);e("#price_card_"+r).val(s),e("#price_cash_"+r).val(p)})}},setFreight=function(t){1==t?(e("#fields_freight").show(),e("#freight").val(1)):(e("#freight").val(0),e("#fields_freight").hide())},setOffer=function(t){1==t&&e("#values_offers").show(),0==t&&e("#values_offers").hide()},setKit=function(t,a,r){1==a?e("#kits").show():e("#kits").hide(),e("#grid_kit").val(a),e(".grid_colors").children(".select-value").text("Selecione Uma"),e("#box-grids-colors").html("")},setStock=function(t,a,r){e("#grid_stock").val(a),e(".grid_colors").children(".select-value").text("Selecione Uma"),e("#box-grids-colors").html("")}}}(jQuery);
